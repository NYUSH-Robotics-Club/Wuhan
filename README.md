# NYUSH-VEX-HighStake 🤖

## 项目简介

这是NYUSH（上海纽约大学）VEX机器人团队为2025年HighStake武汉赛区开发的机器人控制程序。本项目是基于[CPSLO VexCode 2024-2025](https://github.com/CalPolyVEX/VEXCODE-2024-2025)的私有分支开发。

### 赛季信息
- **比赛**: VEX HighStake 2025
- **地区**: 武汉赛区
- **团队**: NYUSH VEX机器人团队
- **平台**: VEX V5 系统

## 目录结构

```
NYUSH-VEX-HighStake/
├── src/                    # 源代码目录
│   ├── main.cpp           # 主程序文件
│   ├── autons.cpp         # 自动程序文件
│   ├── robot-config.cpp   # 机器人配置
│   └── JAR-Template/      # JAR模板库
│       ├── PID.cpp        # PID控制算法
│       ├── drive.cpp      # 底盘驱动控制
│       ├── odom.cpp       # 里程计定位
│       └── util.cpp       # 工具函数
├── include/               # 头文件目录
│   ├── main.h            # 主程序头文件
│   ├── autons.h          # 自动程序头文件
│   ├── robot-config.h    # 机器人配置头文件
│   ├── vex.h             # VEX系统头文件
│   └── JAR-Template/     # JAR模板头文件
├── vex/                  # VEX构建系统
│   ├── mkenv.mk          # 环境配置
│   └── mkrules.mk        # 构建规则
├── .vscode/              # VS Code配置
├── wheels.ipynb          # 轮子校准计算
├── makefile              # 构建配置文件
└── HS_18-2_WorldsGreen.v5code  # VEX代码项目文件
```

## 机器人配置

### 硬件配置
我们的机器人采用以下硬件配置：

#### 驱动系统 (Tank Drive)
- **左侧驱动电机**: L1 (端口6), L2 (端口7), L3 (端口8), L4
- **右侧驱动电机**: R1 (端口1), R2 (端口2), R3 (端口3), R4
- **驱动轮直径**: 2.75英寸
- **齿轮比**: 0.94736842 (约15:16)

#### 机构系统
- **滚筒 (Roller)**: 端口5 - 用于环形物收集
- **传送带 (Conveyor)**: 端口4 - 用于环形物传输
- **壁柱机构 (Wall Stake)**: 端口9 - 双电机系统用于壁柱得分
- **移动目标机构 (Mogo Mech)**: 数字端口D - 气动夹持
- **戳击器 (Doinker)**: 数字端口B/C - 左右双侧气动
- **环形物夹具 (Ring Chuck)**: 数字端口C - 环形物控制

#### 传感器系统
- **惯性传感器 (Inertial)**: 端口21 - 用于陀螺仪导航
- **光学传感器 (Optical)**: 端口21 - 用于环形物颜色检测
- **距离传感器 (Distance)**: 用于环形物检测
- **旋转传感器**: 用于壁柱位置控制
- **限位开关**: 用于机构状态检测

## 功能特性

### 🎯 自动程序 (Autonomous)
项目包含多种自动程序策略：

1. **红方中心路线** (`redGreenAutonCenter`)
   - 抓取移动目标
   - 环形物收集和得分
   - 壁柱得分
   - 联盟柱得分

2. **蓝方中心路线** (`blueGreenAutonCenter`)
   - 镜像红方策略
   - 针对蓝方联盟优化

3. **技能挑战** (`Prog_Skills`)
   - 最大化得分策略
   - 高效路径规划

4. **世界赛程序** (`worlds_auton`, `safe_worlds_auton`)
   - 针对世界赛优化的策略
   - 包含安全备用方案

### 🎮 手动控制 (User Control)
- **双摇杆坦克驱动**: 左摇杆控制左侧，右摇杆控制右侧
- **智能环形物分拣**: 基于颜色传感器的自动分拣
- **多种控制模式**: 
  - 精准控制模式
  - 快速移动模式
  - 壁柱专用控制

### 🧠 智能系统

#### 环形物颜色分拣
```cpp
// 自动检测并分拣正确颜色的环形物
void colorSort() {
    if (ringDetectOverride) return;
    // 颜色检测逻辑
}
```

#### PID控制系统
- **驱动PID**: 精确的直线和转向控制
- **壁柱PID**: 精确的壁柱位置控制
- **自适应参数**: 根据不同情况调整PID参数

#### 里程计定位 (Odometry)
- **双轮编码器**: 提供精确的位置追踪
- **陀螺仪融合**: 结合惯性传感器提高精度
- **实时定位**: 在自动程序中实现精确导航

## 构建和部署

### 环境要求
- VEXcode Pro V5
- VEX V5 Brain
- VEX V5 Controller

### 构建步骤
1. 打开VEXcode Pro V5
2. 导入项目文件 `HS_18-2_WorldsGreen.v5code`
3. 或者使用makefile构建：
   ```bash
   make
   ```
4. 下载到V5 Brain

### 配置说明
项目支持两种硬件配置：
- `GREEN`: 绿方机器人配置
- `GOLD`: 金方机器人配置

通过预编译指令进行切换：
```cpp
#ifdef GREEN
// 绿方特定配置
#endif

#ifdef GOLD  
// 金方特定配置
#endif
```

## 校准工具

### 轮子校准 (`wheels.ipynb`)
使用Jupyter Notebook进行轮子直径精确校准：
- 收集测试数据
- 计算平均值
- 得出精确的轮子直径参数

```python
# 校准数据示例
data = [95.53, 95.70, 95.38, 95.97, 95.74, 95.87]
wheel_diameter = (96.0/(sum/len(data))) * 2.0
```

## 竞赛策略

### HighStake游戏规则要点
1. **环形物得分**: 收集并投放环形物到移动目标
2. **壁柱得分**: 在壁柱上堆叠环形物
3. **移动目标**: 控制移动目标获得额外分数
4. **联盟柱**: 团队合作在联盟柱上得分

### 策略重点
- **快速抓取**: 优化移动目标抓取时间
- **环形物管理**: 智能分拣和路径规划
- **团队配合**: 与联盟伙伴的协调策略
- **防守策略**: 阻止对手得分的策略

## 代码架构

### 主要类和函数

#### Drive类 (JAR-Template)
```cpp
Drive chassis(
    TANK_TWO_ROTATION,
    leftDriveMotors,
    rightDriveMotors,
    INERTIAL,
    2.75,  // 轮子直径
    0.94736842,  // 齿轮比
    360  // 陀螺仪比例
);
```

#### 控制器绑定
- `Controller1.ButtonL1`: 环形物收集
- `Controller1.ButtonL2`: 环形物释放
- `Controller1.ButtonR1`: 壁柱控制
- `Controller1.ButtonR2`: 移动目标控制
- `Controller1.ButtonA`: 戳击器控制

### 状态机设计
```cpp
#define LOADING 1      // 加载状态
#define PRESCORING 2   // 预得分状态  
#define SCORING 3      // 得分状态
```

## 性能优化

### 电机功率管理
- 智能电压控制避免电机过热
- 动态调整最大功率设置
- 电机组协调控制

### 传感器数据处理
- 颜色传感器噪声过滤
- 惯性传感器校准
- 多传感器数据融合

### 内存管理
- 高效的线程管理
- 最小化内存占用
- 实时性能优化

## 调试和测试

### 调试工具
- Brain屏幕状态显示
- Controller振动反馈
- 串口输出调试信息

### 测试程序
- 单独的传感器测试
- 机构功能测试
- 里程计精度测试

### 常见问题排查
1. **电机不转**: 检查端口配置和电机连接
2. **定位不准**: 重新校准惯性传感器
3. **颜色检测失效**: 清洁光学传感器

## 团队协作

### 版本控制
- 使用Git进行版本管理
- 功能分支开发模式
- 定期代码审查

### 开发流程
1. 需求分析
2. 设计方案
3. 编码实现
4. 测试验证
5. 集成部署

## 参赛记录

### 比赛历史
- 2025年HighStake武汉赛区
- 基于CPSLO成功经验的改进

### 荣誉成就
*待更新比赛结果*

## 贡献指南

### 代码规范
- 使用有意义的变量名
- 添加必要的注释
- 遵循C++编程规范

### 提交规范
```
类型(范围): 简短描述

详细描述变更内容
```

## 联系信息

- **团队**: NYUSH VEX机器人团队
- **学校**: 上海纽约大学 (New York University Shanghai)
- **赛季**: VEX HighStake 2024-2025

## 许可证

本项目基于原CPSLO项目开发，仅用于教育和竞赛目的。

---

**祝我们在比赛中取得优异成绩！��**

*最后更新: 2024年*
