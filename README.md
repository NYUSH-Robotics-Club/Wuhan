# VEXCODE-2024-2025
CPSLO VexCode 2024-2025

## 机器人配置

此项目支持两种不同的机器人配置：

### GREEN配置（主配置）
- **驱动电机**: 
  - 左侧: PORT1-PORT4 (比例 6:1)
  - 右侧: PORT5-PORT8 (比例 6:1)
- **进料系统**: 
  - 滚轮: PORT11 (比例 18:1)
  - 传送带: PORT12 (比例 18:1)
- **壁桩系统**: 
  - 左电机: PORT13 (比例 36:1)
  - 右电机: PORT14 (比例 36:1)
  - 旋转传感器: PORT15
- **气动系统**:
  - 移动目标机构: Brain.ThreeWirePort.H
  - 推杆右: Brain.ThreeWirePort.G
  - 推杆左: Brain.ThreeWirePort.F
- **传感器**:
  - 颜色检测: PORT19 (光学传感器)
  - 距离传感器: PORT20
  - IMU陀螺仪: PORT21

### GOLD配置（备用配置）
- 金色机器人的备用端口配置

## 编译配置

在 `makefile` 中默认使用GREEN配置：
```makefile
CPPFLAGS += -DGREEN
# CPPFLAGS += -DGOLD
```

## 🎮 遥控器操作键位

### **肩部按键**
| 按键 | 功能 | 详细说明 |
|------|------|----------|
| **L1** | 进料系统正转 | 启动滚轮和传送带正转，同时启用环检测覆盖 |
| **L2** | 进料系统反转 | 按下时反转，释放时停止 |
| **R1** | 壁桩状态切换 | 循环切换：装载(14°) → 预得分(68°) → 得分(60°) |
| **R2** | 移动目标机构 | 开关移动目标抓取机构，带震动反馈 |

### **方向键**
| 按键 | 功能 | 详细说明 |
|------|------|----------|
| **⬆️ Up** | 蓝方模式 | 设置为蓝方机器人，丢弃红色环 |
| **⬇️ Down** | 右侧推杆 | 切换右侧推杆气动装置 |
| **⬅️ Left** | 红方模式 | 设置为红方机器人，丢弃蓝色环 |
| **➡️ Right** | 翻转器 | 切换翻转器气动装置 |

### **面部按键**
| 按键 | 功能 | 详细说明 |
|------|------|----------|
| **A** | 自动进料 | 持续进料直到检测到环，带震动提示 |
| **B** | 左侧推杆 | 切换左侧推杆气动装置 |

### **摇杆控制**
| 摇杆 | 功能 | 详细说明 |
|------|------|----------|
| **左摇杆** | 底盘驱动 | 街机式控制（前进后退+转向） |
| **右摇杆Y轴** | 手动壁桩 | 直接控制壁桩电机，覆盖自动控制 |

### **壁桩系统角度设置**
| 状态 | GREEN角度 | GOLD角度 | 功能 |
|------|-----------|----------|------|
| **装载** | 14° | 14° | 装载环的位置 |
| **预得分** | 68° | 68° | 准备得分位置 |
| **得分** | 60° | 60° | 最终得分位置 |

### **颜色检测系统**
- **LED亮度**: 25%（节能优化）
- **红色检测**: 350-10度色调范围
- **蓝色检测**: 205-225度色调范围
- **自动分拣**: 根据阵营设置自动丢弃错误颜色的环

### **自动程序选择**
- **Brain屏幕点击**: 循环切换自动程序
- **X键**: 锁定选择并校准陀螺仪
- **Y键**: 解锁自动程序选择

## 🤖 自动程序详解

### **GREEN机器人自动程序**

#### **1. 红方中央冲刺 (Case 0)**
- **名称**: Red Right - RUSH CENTER (GREEN)
- **起始位置**: (24, -48, 0)
- **策略**: 
  - 使用推杆抓取中央移动目标
  - 收集环并得分
  - 前往联盟壁桩得分
  - 触碰梯子获得额外分数
- **执行时间**: 约15秒

#### **2. 蓝方中央冲刺 (Case 1)**  
- **名称**: Blue Left - RUSH CENTER (GREEN)
- **起始位置**: (-24, -48, 0)
- **策略**:
  - 镜像红方策略
  - 使用右侧推杆抓取移动目标
  - 收集环并在联盟壁桩得分
  - 优化路径避免与队友冲突

#### **3. 红方右侧冲刺 (Case 2)**
- **名称**: Red Right - RUSH RIGHT (GREEN)
- **状态**: 待实现
- **策略**: 专注右侧区域的移动目标和环

#### **4. 蓝方左侧冲刺 (Case 3)**
- **名称**: Blue Left - RUSH LEFT (GREEN)  
- **状态**: 待实现
- **策略**: 专注左侧区域的移动目标和环

### **GOLD机器人自动程序**

#### **1. 红方左侧冲刺 (Case 0)**
- **名称**: Red Left - RUSH LEFT (GOLD)
- **起始位置**: (-24, -48, 0)
- **策略**:
  - 抓取对方移动目标并得分
  - 收集多个环堆栈
  - 清理场地角落
  - 使用推杆清扫环

#### **2. 蓝方右侧冲刺 (Case 1)**
- **名称**: Blue Right - RUSH RIGHT (GOLD)
- **起始位置**: (24, -48, 0)
- **策略**:
  - 镜像红方GOLD策略
  - 优化移动目标抓取时机
  - 最大化环收集效率

### **特殊自动程序**

#### **AWP+1程序**
- **功能**: 联盟壁桩得分 + 触碰梯子
- **用途**: 简单可靠的得分策略
- **执行时间**: 约5秒

#### **编程技能赛**
- **功能**: 完整的技能赛程序
- **策略**: 
  - 收集所有可用环
  - 多个移动目标得分
  - 最大化分数

#### **测试程序**
- **odom_test**: 里程计测试和校准
- **worlds_auton**: 世界赛专用程序
- **safe_worlds_auton**: 安全版世界赛程序

## 🔧 JAR-Template底盘系统

### **核心特性**
- **精确定位**: 使用编码器和IMU进行位置追踪
- **PID控制**: 独立的驱动、转向、摆动PID控制器
- **路径规划**: 支持点到点导航和路径跟踪
- **自动校准**: 陀螺仪自动校准和误差补偿

### **控制参数**
```cpp
// 驱动PID: kP=12, kI=1.5, kD=0, 启动电压=10, 积分区间=0
chassis.set_drive_constants(12, 1.5, 0.0, 10, 0);

// 转向PID: kP=6, kI=0.5, kD=0, 启动电压=1.2, 积分区间=0  
chassis.set_heading_constants(6, .5, 0, 1.2, 0);

// 旋转PID: kP=12, kI=0.4, kD=0.01, 启动电压=3.1, 积分区间=15
chassis.set_turn_constants(12, .4, 0.01, 3.1, 15);
```

### **运动函数**
- `chassis.drive_distance(distance)`: 直线驱动
- `chassis.turn_to_angle(angle)`: 转向指定角度
- `chassis.drive_to_point(x, y)`: 驱动到指定坐标
- `chassis.turn_to_point(x, y)`: 转向指定坐标

## 🎨 颜色分拣系统详解

### **硬件配置**
- **光学传感器**: PORT19，25%亮度
- **距离传感器**: PORT20，检测环的存在
- **集成时间**: 5ms，快速响应

### **颜色识别算法**
```cpp
// 获取色调值
ringColor = colorDetect.hue();

// 红色判定：350-360度 或 0-10度
bool ringIsRed = ringColor >= 350 || ringColor <= 10;

// 蓝色判定：205-225度  
bool ringIsBlue = ringColor >= 205 && ringColor <= 225;
```

### **分拣逻辑**
1. **距离检测**: 检测环是否接近传感器
2. **颜色识别**: 读取环的色调值
3. **阵营判断**: 根据机器人阵营决定保留或丢弃
4. **执行动作**: 控制传送带正转或反转

### **分拣模式**
- **红方模式**: 保留红色环，丢弃蓝色环
- **蓝方模式**: 保留蓝色环，丢弃红色环
- **覆盖模式**: 手动控制时禁用自动分拣

## 🔩 壁桩控制系统

### **三状态控制**
1. **装载状态 (LOADING)**
   - 角度：14度
   - 功能：接收环的装载位置
   - 触发：等待传送带电流检测

2. **预得分状态 (PRESCORING)**
   - 角度：68度
   - 功能：准备得分位置
   - 特殊：按Y键可微调到59度

3. **得分状态 (SCORING)**
   - 角度：60度
   - 功能：最终得分位置
   - 执行：自动回收并重置

### **PID控制参数**
- **装载**: kP=300/200, kD=0, 容差=1度
- **预得分**: kP=250, kD=0, 容差=3度
- **得分**: kP=200, kD=0, 容差=5度

### **手动控制**
- **右摇杆Y轴**: 直接控制壁桩电机
- **覆盖自动**: 手动控制时禁用自动状态机

## 🛠️ 气动系统

### **移动目标机构 (mogoMech)**
- **端口**: Brain.ThreeWirePort.H
- **功能**: 抓取和释放移动目标
- **控制**: R2键切换，带震动反馈

### **推杆系统**
- **左推杆**: Brain.ThreeWirePort.F (B键控制)
- **右推杆**: Brain.ThreeWirePort.G (Down键控制)
- **功能**: 推动环和阻挡对手

### **翻转器 (tipper)**
- **控制**: Right键
- **功能**: 翻转环或触碰梯子

## 📊 传感器系统

### **IMU陀螺仪 (PORT21)**
- **功能**: 提供精确的角度和角速度数据
- **校准**: 自动程序开始时自动校准
- **用途**: 底盘控制和自动程序导航

### **距离传感器 (PORT20)**
- **功能**: 检测环的距离
- **阈值**: 2.5英寸内检测到环
- **用途**: 自动进料和颜色分拣触发

### **旋转传感器 (PORT15)**
- **功能**: 监测壁桩角度
- **精度**: 1度分辨率
- **用途**: 壁桩位置反馈和PID控制

## 项目结构

```
VEXCODE-2024-2025/
├── src/                    # 源代码目录
│   ├── main.cpp           # 主程序文件
│   ├── robot-config.cpp   # 机器人配置
│   └── autons.cpp         # 自动程序
├── include/               # 头文件目录
│   ├── robot-config.h     # 机器人配置头文件
│   └── autons.h          # 自动程序头文件
├── JAR-Template/          # 底盘驱动系统库
└── vex/                   # VEX编译配置
```

## 功能特性

- **高级底盘控制**: 使用JAR-Template库实现精确的位置追踪和PID控制
- **智能颜色分拣**: 自动识别环颜色并根据阵营进行分拣
- **多状态壁桩系统**: 支持装载、预得分、得分多种状态
- **完整的自动程序**: 支持红蓝双方多种策略
- **气动系统控制**: 移动目标机构和推杆系统
- **传感器集成**: IMU、光学传感器、距离传感器等

## 🚀 使用指南

### **编译和部署**
1. 使用VEXcode Pro V5打开项目
2. 确认makefile中的机器人配置（GREEN/GOLD）
3. 编译并下载到机器人大脑

### **自动程序使用**
1. 开机后进入自动程序选择界面
2. 点击Brain屏幕循环选择程序
3. 按X键锁定选择并校准陀螺仪
4. 确认机器人位置正确后开始比赛

### **手动控制**
1. 使用左摇杆控制底盘移动
2. 使用肩部按键控制进料系统
3. 使用R1键切换壁桩状态
4. 使用方向键设置颜色分拣模式

### **调试和测试**
1. 使用Brain屏幕查看传感器数据
2. 使用Controller屏幕查看状态信息
3. 使用printf输出调试信息到终端
